<%= form_tag weapons_index_path, method: :get do %>
  <%= label_tag :type, 'Select weapon type' %>
  <%= select_tag :type, weapon_type_options(params[:type]), onchange: 'submit();' %>
  <%= submit_tag 'Search', class: 'hide' %>
<% end %>

<% cache ['v1', 'weapons', cache_key_for_weapons, params] do %>

  <table class='center'>
    <tr>
      <th class='name'>
        <%= sort_link 'Name' %>
      </th>

      <th class='tier'>
        <%= sort_link 'Tier' %>
      </th>

      <th class='stat'>
        <%= sort_link 'Attack', stat_description('Attack') %>
      </th>

      <%# Rocket launchers have velocity and blast radius, others impact and range %>
      <% if params[:type] == 'rocket_launcher' %>
        <th class='stat'>
          <%= sort_link 'Velo', stat_description('Velocity') %>
        </th>

        <th class='stat'>
          <%= sort_link 'Blast', stat_description('Blast Radius') %>
        </th>
      <% else %>
        <th class='stat'>
          <%= sort_link 'Impact', stat_description('Impact') %>
        </th>

        <th class='stat'>
          <%= sort_link 'Range', stat_description('Range') %>
        </th>
      <% end %>

      <th class='stat'>
        <%= sort_link 'Stab', stat_description('Stability') %>
      </th>

      <%# Fusion rifles have charge rate, others rate of fire %>
      <% if params[:type] == 'fusion_rifle' %>
        <th class='stat'>
          <%= sort_link 'Charge', stat_description('Charge Rate') %>
        </th>
      <% else %>
        <th class='stat'>
          <%= sort_link 'ROF', stat_description('Rate of Fire') %>
        </th>
      <% end %>

      <th class='stat'>
        <%= sort_link 'AA', stat_description('Aim assistance') %>
      </th>

      <th class='stat'>
        <%= sort_link 'Mag', stat_description('Magazine') %>
      </th>

      <th class='stat'>
        <%= sort_link 'Reload', stat_description('Reload') %>
      </th>

      <th class='stat'>
        <%= sort_link 'Equip', stat_description('Equip Speed') %>
      </th>
    </tr>

    <% @weapons.each do |weapon| %>
      <tr class="active <%= cycle("odd", "even") %>">
        <td class='name'>
          <%= armory_link weapon  %>
        </td>

        <td class="tier <%= weapon.tier %>">
          <%= weapon.tier.first %>
        </td>

        <td class='stat'>
          <%= weapon.attack %>
        </td>

        <%# Rocket launchers have velocity and blast radius, others impact and range %>
        <% if params[:type] == 'rocket_launcher' %>
          <td class='stat'>
            <%= weapon.velocity %>
          </td>

          <td class='stat'>
            <%= weapon.blast_radius %>
          </td>
        <% else %>
          <td class='stat'>
            <%= weapon.impact %>
          </td>

          <td class='stat'>
            <%= weapon.range %>
          </td>
        <% end %>

        <td class='stat'>
          <%= weapon.stability %>
        </td>

        <%# Fusion rifles have charge rate, others rate of fire %>
        <% if params[:type] == 'fusion_rifle' %>
          <td class='stat'>
            <%= weapon.charge_rate %>
          </td>
        <% else %>
          <td class='stat'>
            <%= weapon.rate_of_fire %>
          </td>
        <% end %>

        <td class='stat'>
          <%= weapon.aim_assistance %>
        </td>

        <td class='stat'>
          <%= weapon.magazine %>
        </td>

        <td class='stat'>
          <%= weapon.reload_speed %>
        </td>

        <td class='stat'>
          <%= weapon.equip_speed %>
        </td>
      </tr>
    <% end %>
  </table>

<% end %>
